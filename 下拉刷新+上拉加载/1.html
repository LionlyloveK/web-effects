<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Document</title>
	<style type="text/css">
		html,body,header,div,main,p,span,ul,li{ margin: 0; padding: 0; }
		#refreshContainer{
			/* padding-top: 510px; */
		}
		#refreshContainer li{ background-color: #eee; margin-bottom: 1px; padding: 20px 10px; }
		.refreshText{ line-height: 50px; text-align: center; }
		.hd{
			width:100%;
			height: 300px;
			background-color: #193EAF;
			position: relative;
			/* position: fixed;
			top: 0; */
		}
		.hd1{
			width:100%;
			height: 100px;
			background-color: #ff5500;
		}
	</style>
</head>
<body>
<main>
	<div class="hd1">111</div>
	<div class="hd">这是头部</div>
	<ul id="refreshContainer">
		<li>111</li>
		<li>222</li>
		<li>333</li>
		<li>444</li>
		<li>555</li>
		<li>111</li>
		<li>222</li>
		<li>333</li>
		<li>444</li>
		<li>555</li>
		<li>111</li>
		<li>222</li>
		<li>333</li>
		<li>444</li>
		<li>555</li>
	</ul>
	<p class="refreshText"></p>
</main>

<script type="text/javascript">
(function(window) {
	// 获取当前滚动条的位置 
    function getScrollTop() { 
	    var scrollTop = 0; 
	    if (document.documentElement && document.documentElement.scrollTop) { 
	    	scrollTop = document.documentElement.scrollTop; 
	    } else if (document.body) { 
	    	scrollTop = document.body.scrollTop; 
	    } 
		console.log(scrollTop)
		let d=document.getElementsByClassName("hd")[0],a=document.getElementById("refreshContainer"),
		c=document.getElementsByClassName('hd1')[0]
		console.log(c.offsetHeight)
		if (scrollTop >= 100) {
			
			d.style.position="fixed";
			d.style.top="0";
			a.style.paddingTop="310px"
		}else{
			d.style.position="relative";
			a.style.paddingTop="10px"
		}
	    return scrollTop; 
    } 

    // 获取当前可视范围的高度 
    function getClientHeight() { 
	    var clientHeight = 0; 
	    if (document.body.clientHeight && document.documentElement.clientHeight) { 
	    	clientHeight = Math.min(document.body.clientHeight, document.documentElement.clientHeight); 
	    } 
	    else { 
	    	clientHeight = Math.max(document.body.clientHeight, document.documentElement.clientHeight); 
	    } 
	    return clientHeight; 
    }

    // 获取文档完整的高度 
    function getScrollHeight() { 
    	return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight); 
    }

    var _text = document.querySelector('.refreshText'),
    _container = document.getElementById('refreshContainer');

	//// 节流函数
    var throttle = function(method, context){
		  clearTimeout(method.tId);
		  method.tId = setTimeout(function(){
		    method.call(context);
		  }, 300);
	}

    function fetchData() {
    	setTimeout(function() {
			for(let i=0;i<10;i++){
				_container.insertAdjacentHTML('beforeend', '<li>new add...'+i+'</li>');
			}
 
    	}, 1000);
    }

    window.onscroll = function() {
      	if (getScrollTop() + getClientHeight() == getScrollHeight()) {
      		_text.innerText = '加载中...';
      		throttle(fetchData);
      	}
    };

})(window);
</script>
</body>
</html>